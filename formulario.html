<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<title>Formulario de Cotización</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f0f4f8;
    padding: 20px;
    max-width: 600px;
    margin: auto;
  }
  label {
    display: block;
    margin-top: 15px;
    font-weight: bold;
  }
  input, textarea {
    width: 100%;
    padding: 8px;
    margin-top: 5px;
    box-sizing: border-box;
  }
  #conceptos {
    min-height: 80px;
  }
  button {
    margin-top: 20px;
    background: #1565c0;
    color: white;
    border: none;
    padding: 10px 20px;
    cursor: pointer;
  }
  button:hover {
    background: #0d3c91;
  }
  #response {
    margin-top: 20px;
    font-weight: bold;
  }
</style>
</head>
<body>

<h1>Formulario de Cotización</h1>

<form id="cotizacionForm">

  <label for="cliente">Cliente:</label>
  <input type="text" id="cliente" name="cliente" required />

  <label for="dependencia">Dependencia:</label>
  <input type="text" id="dependencia" name="dependencia" required />

  <label for="atencion">Con Atención a:</label>
  <input type="text" id="atencion" name="atencion" required />

  <label for="conceptos">Conceptos (una línea por concepto):</label>
  <textarea id="conceptos" name="conceptos" placeholder="Ejemplo: Producto A - $100&#10;Producto B - $200" required></textarea>

  <label for="subtotal">Subtotal:</label>
  <input type="number" id="subtotal" name="subtotal" min="0" step="0.01" required />

  <label for="iva">IVA (16%):</label>
  <input type="number" id="iva" name="iva" min="0" step="0.01" readonly />

  <label for="total">Total:</label>
  <input type="number" id="total" name="total" min="0" step="0.01" readonly />

  <button type="submit">Enviar Cotización</button>

</form>

<div id="response"></div>

<script>
  const form = document.getElementById('cotizacionForm');
  const subtotalInput = document.getElementById('subtotal');
  const ivaInput = document.getElementById('iva');
  const totalInput = document.getElementById('total');
  const responseDiv = document.getElementById('response');

  // Calcula IVA y Total cuando cambia el subtotal
  subtotalInput.addEventListener('input', () => {
    const subtotal = parseFloat(subtotalInput.value) || 0;
    const iva = +(subtotal * 0.16).toFixed(2);
    const total = +(subtotal + iva).toFixed(2);
    ivaInput.value = iva;
    totalInput.value = total;
  });

  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    const data = {
      cliente: form.cliente.value,
      dependencia: form.dependencia.value,
      atencion: form.atencion.value,
      conceptos: form.conceptos.value,
      subtotal: form.subtotal.value,
      iva: form.iva.value,
      total: form.total.value,
    };

    try {
      const response = await fetch('TU_WEB_APP_URL_AQUI', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data),
      });

      if (!response.ok) throw new Error('Error en la respuesta del servidor');

      const result = await response.json();

      responseDiv.style.color = 'green';
      responseDiv.textContent = result.message;

      form.reset();
      ivaInput.value = '';
      totalInput.value = '';

    } catch (error) {
      responseDiv.style.color = 'red';
      responseDiv.textContent = 'Error al guardar en Sheets: ' + error.message;
    }
  });
</script>

</body>
</html>

